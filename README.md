# go-wire-example

A simple example of how to use go-wire.

## Usage

```bash
make wire

make run
```

## test case

```bash
curl "http://localhost:8080/api/v1/login" -H "Content-Type: application/json" -d '{"username": "go-eagle", "password": "123456"}'
# Output
{
    "user": {
        "username": "go-eagle",
        "password": "123456"
    }
}
```

## 关键部分

wire 注入

```go
// wire.go
//go:build wireinject
// +build wireinject

package main

import (
	"go-wire-example/handler"

	"github.com/google/wire"
)

func InitializeApp() (*App, error) {
	wire.Build(
		handler.HandlerSet,         // 汇总所有 Handler 的依赖
		wire.Struct(new(App), "*"), // 自动注入到 App 结构
	)
	return &App{}, nil
}
```

生成后的 wire_gen.go

```go
// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package main

import (
	"go-wire-example/cache"
	"go-wire-example/handler"
	"go-wire-example/repo"
	"go-wire-example/service"
)

// Injectors from wire.go:

func InitializeApp() (*App, error) {
	userRepo := repo.NewUserRepo()
	userCache := cache.NewUserCache()
	userService := service.NewUserService(userRepo, userCache)
	userHandler := handler.NewUserHandler(userService)
	productRepo := repo.NewProductRepo()
	productCache := cache.NewProductCache()
	productService := service.NewProductService(productRepo, productCache)
	productHandler := handler.NewProductHandler(productService)
	app := &App{
		UserHandler:    userHandler,
		ProductHandler: productHandler,
	}
	return app, nil
}
```

> 如果不使用依赖注入，这些初始化都需要手动编写

